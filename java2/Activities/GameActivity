package Activities;
import androidx.appcompat.app.AppCompatActivity;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.ImageView;
import android.widget.TextView;

import Model.GameLogic; 
import com.waikato.whackamole.R; 

public class GameActivity extends AppCompatActivity {

    private ImageView[] moleImageViews;
    private TextView tvTimer;
    private TextView tvScore;
    private GameLogic gameLogic;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_game);

        initViews();
        gameLogic = new GameLogic(moleImageViews, this);
        gameLogic.startGame();
    }

    private void initViews() {
        moleImageViews = new ImageView[9];
        moleImageViews[0] = findViewById(R.id.iv_without_mole_01);
        moleImageViews[1] = findViewById(R.id.iv_without_mole_02);
        moleImageViews[2] = findViewById(R.id.iv_without_mole_03);
        moleImageViews[3] = findViewById(R.id.iv_without_mole_04);
        moleImageViews[4] = findViewById(R.id.iv_without_mole_05);
        moleImageViews[5] = findViewById(R.id.iv_without_mole_06);
        moleImageViews[6] = findViewById(R.id.iv_without_mole_07);
        moleImageViews[7] = findViewById(R.id.iv_without_mole_08);
        moleImageViews[8] = findViewById(R.id.iv_without_mole_09);

        tvTimer = findViewById(R.id.tv_timer_text);
        tvScore = findViewById(R.id.tv_score_text);
        tvTimer.setText("Time: 30");
        tvScore.setText("Score: 0");
    }

    public void onMoleClick(View view) {
        int moleIndex = (int) view.getTag();
        gameLogic.onMoleClick(moleIndex);
    }

    public void updateTimer(int remainingTime) {
        tvTimer.setText("Time: " + remainingTime);
    }

    public void updateScore(int score) {
        tvScore.setText("Score: " + score);
    }

    public void gameOver(int finalScore) {
        Intent intent = new Intent(this, PlayerActivity.class);
        intent.putExtra("finalScore", finalScore);
        startActivity(intent);
        finish();
    }

    @Override
    protected void onPause() {
        super.onPause();
        if (gameLogic != null && gameLogic.isGameRunning()) {
            gameLogic.getMoleHandler().removeCallbacks(gameLogic.getMoleRunnable());
        }
    }

    @Override
    protected void onResume() {
        super.onResume();
        if (gameLogic != null && gameLogic.isGameRunning()) {
            gameLogic.getMoleHandler().post(gameLogic.getMoleRunnable());
        }
    }
}
